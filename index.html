<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maya - Million Dollar Gap Breakthrough Session</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .chat-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
        }
        
        .message {
            margin-bottom: 15px;
            max-width: 80%;
        }
        
        .message.maya {
            background: #e0f2f1;
            padding: 12px 16px;
            border-radius: 16px;
            color: #333;
        }
        
        .message.user {
            background: #f5f5f5;
            padding: 12px 16px;
            border-radius: 16px;
            margin-left: auto;
            color: #333;
        }
        
        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
            outline: none;
        }
        
        input[type="text"]:focus {
            border-color: #4db6ac;
        }
        
        .send-btn {
            background: #4db6ac;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .revenue-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .revenue-btn {
            background: white;
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
        }
        
        .revenue-btn:hover {
            background: #f0f8f8;
            border-color: #4db6ac;
        }
        
        .purchase-btn {
            background: #4db6ac;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
            background: #e0f2f1;
            border-radius: 16px;
            max-width: 60px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            background: #4db6ac;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        
        .session-ended {
            text-align: center;
            padding: 20px;
            background: #f0f8f8;
            border-radius: 6px;
            border: 1px solid #4db6ac;
            margin-top: 10px;
        }
        
        .session-ended a {
            color: #4db6ac;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will appear here -->
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
        
        <div class="input-container">
            <div class="input-group">
                <input type="text" id="userInput" placeholder="Type your message..." maxlength="500">
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
            <div id="revenueOptions" class="revenue-options" style="display: none;">
                <!-- Revenue buttons will appear here -->
            </div>
        </div>
    </div>

    <script>
        // API endpoint - now points to your secure Vercel backend
        const API_ENDPOINT = '/api/chat';
        
        // Conversation state
        let conversationState = {
            stage: 'greeting',
            userData: {},
            messages: [],
            hasUsedSession: false
        };
        
        // Simple template-filling prompt
        const MAYA_PROMPT = `You are a helpful assistant that fills in a template with user information.

Take the template below and replace the placeholders with appropriate interpretations of the user's information:

[NAME] = use their exact name
[INDUSTRY] = interpret their niche naturally (e.g., "life organization" for "help women organize their lives")
[CHALLENGE] = interpret their challenge naturally (e.g., "lead generation" for "I need more leads", "content strategy" for "content creation")  
[ATTEMPTS] = interpret what they've tried naturally (e.g., "increasing your content output" for "posting more")

Only replace the placeholders. Do not change any other text.`;

        // Check if user has already used the session
        function checkSessionUsage() {
            const hasUsed = localStorage.getItem('maya_session_used');
            if (hasUsed) {
                showSessionEndedMessage();
                return true;
            }
            return false;
        }
        
        // Mark session as used
        function markSessionUsed() {
            localStorage.setItem('maya_session_used', 'true');
        }
        
        // Initialize chat
        function initializeChat() {
            if (checkSessionUsage()) {
                return;
            }
            
            addMayaMessage("ðŸ‘‹ Hello! I'm Maya, your Million Dollar Gap Advisor. Type 'hello' to begin your breakthrough session!");
        }
        
        // Add message to chat
        function addMessage(content, isUser = false) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'maya'}`;
            messageDiv.innerHTML = content;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function addMayaMessage(content) {
            addMessage(content, false);
        }
        
        function addUserMessage(content) {
            addMessage(content, true);
        }
        
        // Show typing indicator
        function showTyping() {
            document.getElementById('typingIndicator').style.display = 'flex';
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
        }
        
        // Hide typing indicator
        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }
        
        // Handle revenue selection
        function selectRevenue(range) {
            conversationState.userData.revenue = range;
            addUserMessage(range);
            hideRevenueOptions();
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    let response = getRevenueResponse(range);
                    addMayaMessage(response);
                    conversationState.stage = 'main_question';
                }, 1500);
            }, 500);
        }
        
        function getRevenueResponse(range) {
            let response = "";
            if (range.includes("20k+")) {
                response = `Amazing, ${conversationState.userData.name}! You're clearly doing something right - ${conversationState.userData.timeInBusiness} in business and over $20k/month shows you know how to create real transformation for your clients.<br><br>`;
            } else if (range.includes("10k-20k")) {
                response = `Fantastic, ${conversationState.userData.name}! ${conversationState.userData.timeInBusiness} in business and hitting $10k-20k months shows you've built something solid.<br><br>`;
            } else if (range.includes("5k-10k")) {
                response = `Great work, ${conversationState.userData.name}! You're in that sweet spot where you've proven your concept works.<br><br>`;
            } else {
                response = `Thanks for sharing, ${conversationState.userData.name}! You're building something meaningful.<br><br>`;
            }
            
            response += `Now here's the question that usually reveals everything: <strong>What's the main thing you've been trying to get better at to grow your business?</strong>`;
            return response;
        }
        
        // Show revenue options
        function showRevenueOptions() {
            const revenueDiv = document.getElementById('revenueOptions');
            revenueDiv.style.display = 'grid';
            revenueDiv.innerHTML = `
                <button class="revenue-btn" onclick="selectRevenue('Under $5k/month')">Under $5k/month</button>
                <button class="revenue-btn" onclick="selectRevenue('$5k-$10k/month')">$5k-$10k/month</button>
                <button class="revenue-btn" onclick="selectRevenue('$10k-$20k/month')">$10k-$20k/month</button>
                <button class="revenue-btn" onclick="selectRevenue('Over $20k/month')">Over $20k/month</button>
            `;
            document.getElementById('userInput').style.display = 'none';
            document.getElementById('sendBtn').style.display = 'none';
        }
        
        // Hide revenue options
        function hideRevenueOptions() {
            document.getElementById('revenueOptions').style.display = 'none';
            document.getElementById('userInput').style.display = 'block';
            document.getElementById('sendBtn').style.display = 'block';
        }
        
        // Log user responses to Vercel logs
        function logUserResponse() {
            const userData = conversationState.userData;
            console.log('=== NEW CHAT COMPLETION ===');
            console.log('Date:', new Date().toISOString());
            console.log('Name:', userData.name || 'Not provided');
            console.log('Niche:', userData.niche || 'Not provided');
            console.log('Time in Business:', userData.timeInBusiness || 'Not provided');
            console.log('Revenue:', userData.revenue || 'Not provided');
            console.log('Main Challenge:', userData.mainChallenge || 'Not provided');
            console.log('What They Tried:', userData.attempted || 'Not provided');
            console.log('=== END CHAT DATA ===');
        }
        
        // Process user input based on conversation stage
        async function processUserInput(input) {
            conversationState.messages.push({role: 'user', content: input});
            
            switch(conversationState.stage) {
                case 'greeting':
                    if (input.toLowerCase().includes('hello') || input.toLowerCase().includes('hi')) {
                        conversationState.stage = 'name';
                        return `Hey! I'm Maya, and I help established women entrepreneurs identify the million dollar gap in their business strategy.<br><br>Before we dive in, I'd love to learn a bit about you and your business so I can give you the most relevant insights. Let me ask you a few quick questions:<br><br><strong>What's your name?</strong>`;
                    } else {
                        return `Hi there! Please type 'hello' to begin your Million Dollar Gap breakthrough session.`;
                    }
                    
                case 'name':
                    conversationState.userData.name = input;
                    conversationState.stage = 'niche';
                    return `Nice to meet you, ${input}!<br><br><strong>Who do you help? (What's your niche or industry?)</strong>`;
                    
                case 'niche':
                    conversationState.userData.niche = input;
                    conversationState.stage = 'time_in_business';
                    return `That's beautiful work, ${conversationState.userData.name}! ${input} is such important work.<br><br><strong>How long have you been in business?</strong>`;
                    
                case 'time_in_business':
                    conversationState.userData.timeInBusiness = input;
                    conversationState.stage = 'revenue';
                    setTimeout(() => {
                        showRevenueOptions();
                    }, 500);
                    return `Wow, ${input} - that's incredible staying power! You've clearly built something meaningful.<br><br><strong>What's your current monthly revenue range?</strong>`;
                    
                case 'main_question':
                    conversationState.userData.mainChallenge = input;
                    conversationState.stage = 'follow_up';
                    return `Got it. What have you tried so far to improve this?`;
                    
                case 'follow_up':
                    conversationState.userData.attempted = input;
                    conversationState.stage = 'complete';
                    markSessionUsed();
                    
                    // Log all the user responses to Vercel logs
                    logUserResponse();
                    
                    return await generatePersonalizedReframe();
                    
                default:
                    return `I'm not sure I understand. Could you please rephrase that?`;
            }
        }
        
        // Handle user input
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            input.disabled = true;
            document.getElementById('sendBtn').disabled = true;
            
            addUserMessage(message);
            input.value = '';
            
            showTyping();
            
            try {
                const response = await processUserInput(message);
                
                setTimeout(() => {
                    hideTyping();
                    addMayaMessage(response);
                    
                    input.disabled = false;
                    document.getElementById('sendBtn').disabled = false;
                    input.focus();
                }, 1500);
                
            } catch (error) {
                hideTyping();
                addMayaMessage("I'm having a technical moment! Please try again.");
                input.disabled = false;
                document.getElementById('sendBtn').disabled = false;
            }
        }
        
        // Handle Enter key
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // Generate personalized reframe using OpenAI
        async function generatePersonalizedReframe() {
            const userData = conversationState.userData;
            
            const template = `I totally get it, [NAME]. Many entrepreneurs in [INDUSTRY] focus on [CHALLENGE], and you've clearly been putting in the work with [ATTEMPTS]. But constantly trying to perfect tactics keeps you stuck in reactive mode rather than building strategic business architecture.

What if instead of trying to get better at [CHALLENGE], you built an ecosystem that encapsulates your magic and delivers it to the right person at the right time - so you can wake up to new sales from work you did last year?

Here's the thing - you're already successful. You know how to create results. But what got you to where you are now isn't going to get you to your next level without burning you out.

**I just revealed what I call the Million Dollar Gap - the space between tactical improvements and strategic business architecture.** Most entrepreneurs stay stuck in tactics because they don't know how to build the architecture.

Chelsie actually created something specifically for women entrepreneurs like you, desiring to grow beyond the constant tactical improvements. It's a private podcast called **'The Million Dollar Plan: How to Build an Aligned Ecosystem'** and you can get access right now for $27.

In the 3 quick and easy-to-listen-to episodes, Chelsie walks you through the exact process she takes her private clients through to encapsulate their magic and deliver it to the right person at the right time, so you can wake up to new sales from work you did last year.

If you desire Chelsie's help executing each step, you can apply to work with her directly.

Ready to close the gap?`;

            const userDataString = `Please fill in this template with the user's information:

Template: ${template}

User Information:
Name: ${userData.name}
Niche: ${userData.niche}  
Time in business: ${userData.timeInBusiness}
Revenue: ${userData.revenue}
Main challenge: ${userData.mainChallenge}
What they've tried: ${userData.attempted}

Replace [NAME], [INDUSTRY], [CHALLENGE], and [ATTEMPTS] with natural interpretations of the user's information.`;

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: userDataString }],
                        prompt: MAYA_PROMPT
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'API call failed');
                }
                
                let reframe = data.message;
                reframe += '<br><br><button class="purchase-btn" onclick="window.open(\'https://www.chelsiekenyon.com/milliondollarplan\', \'_blank\')">Get The Million Dollar Plan - $27</button>';
                
                return reframe;
                
            } catch (error) {
                console.error('API Error:', error);
                return generateFallbackReframe();
            }
        }
        
        // Fallback reframe if API fails
        function generateFallbackReframe() {
            const userData = conversationState.userData;
            
            let reframe = `I totally get it, ${userData.name}. Many entrepreneurs in your industry focus on ${userData.mainChallenge}, and you've clearly been putting in the work with ${userData.attempted}. But constantly trying to perfect tactics keeps you stuck in reactive mode rather than building strategic business architecture.<br><br>`;
            
            reframe += `What if instead of trying to get better at ${userData.mainChallenge}, you built an ecosystem that encapsulates your magic and delivers it to the right person at the right time - so you can wake up to new sales from work you did last year?<br><br>`;
            
            reframe += `Here's the thing - you're already successful. You know how to create results. But what got you to where you are now isn't going to get you to your next level without burning you out.<br><br>`;
            
            reframe += `<strong>I just revealed what I call the Million Dollar Gap - the space between tactical improvements and strategic business architecture.</strong> Most entrepreneurs stay stuck in tactics because they don't know how to build the architecture.<br><br>`;
            
            reframe += `Chelsie actually created something specifically for women entrepreneurs like you, desiring to grow beyond the constant tactical improvements. It's a private podcast called <strong>'The Million Dollar Plan: How to Build an Aligned Ecosystem'</strong> and you can get access right now for $27.<br><br>`;
            
            reframe += `In the 3 quick and easy-to-listen-to episodes, Chelsie walks you through the exact process she takes her private clients through to encapsulate their magic and deliver it to the right person at the right time, so you can wake up to new sales from work you did last year.<br><br>`;
            
            reframe += `If you desire Chelsie's help executing each step, you can apply to work with her directly.<br><br>`;
            
            reframe += '<button class="purchase-btn" onclick="window.open(\'https://www.chelsiekenyon.com/milliondollarplan\', \'_blank\')">Get The Million Dollar Plan - $27</button><br><br>';
            
            reframe += `Ready to close the gap?`;
            
            return reframe;
        }
        
        // Show session ended message
        function showSessionEndedMessage() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = `
                <div class="session-ended">
                    <h3>Session Complete!</h3>
                    <p>You've already experienced your Million Dollar Gap breakthrough session. Each person gets one personalized session.</p>
                    <p>Ready to dive deeper? <a href="https://www.chelsiekenyon.com/milliondollarplan" target="_blank">Get The Million Dollar Plan</a></p>
                </div>
            `;
            
            document.getElementById('userInput').style.display = 'none';
            document.getElementById('sendBtn').style.display = 'none';
            document.getElementById('revenueOptions').style.display = 'none';
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeChat();
        });
    </script>
</body>
</html>
