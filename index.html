<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maya - Million Dollar Gap Breakthrough Session</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .chat-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            width: 100%;
            max-width: 650px;
            height: 650px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
        }
        
        .message {
            margin-bottom: 15px;
            max-width: 85%;
            line-height: 1.4;
        }
        
        .message.maya {
            background: #1f4372;
            padding: 12px 16px;
            border-radius: 16px 16px 16px 6px;
            color: white;
        }
        
        .message.user {
            background: #2b9ab6;
            padding: 12px 16px;
            border-radius: 16px 16px 6px 16px;
            margin-left: auto;
            color: white;
            border: 1px solid #1f4372;
        }
        
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: #1f4372;
            border-radius: 16px;
            max-width: 100px;
            margin-bottom: 15px;
        }
        
        .typing-text {
            color: white;
            font-style: italic;
            font-size: 14px;
        }
        
        .typing-dots {
            display: flex;
            gap: 3px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            background: #4db6ac;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-4px); opacity: 1; }
        }
        
        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        input[type="text"]:focus {
            border-color: #2b9ab6;
        }
        
        .send-btn {
            background: #1f4372;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        
        .send-btn:hover {
            background: #174063;
        }
        
        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .revenue-options {
            display: none;
        }
        
        .purchase-btn {
            background: #2b9ab6;
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        
        .purchase-btn:hover {
            background: #238a9f;
        }
        
        @media (max-width: 480px) {
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
            
            .chat-container {
                height: 100vh;
                border-radius: 0;
                margin: 0;
                display: flex;
                flex-direction: column;
            }
            
            .chat-messages {
                flex: 1;
                padding: 15px 15px 140px 15px; /* Much larger bottom padding */
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                scroll-padding-bottom: 140px; /* Ensures scroll includes padding */
            }
            
            .typing-indicator {
                margin-left: 15px;
                margin-right: 15px;
                margin-bottom: 30px; /* More space from bottom */
            }
            
            .input-container {
                padding: 15px;
                background: white;
                border-top: 1px solid #e0e0e0;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 1000;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                min-height: 80px; /* Ensure consistent height */
            }
            
            input[type="text"] {
                font-size: 16px;
                padding: 14px 16px;
            }
            
            .send-btn {
                padding: 14px 24px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will appear here -->
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <span class="typing-text">Maya is typing</span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        
        <div class="input-container">
            <div class="input-group">
                <input type="text" id="userInput" placeholder="Type your message..." maxlength="500">
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
            <div id="revenueOptions" class="revenue-options" style="display: none;">
                <!-- Revenue buttons will appear here -->
            </div>
        </div>
    </div>

    <script>
        const API_ENDPOINT = 'https://maya-chat-widget.vercel.app/api/chat';
        
        let conversationState = {
            stage: 'greeting',
            userData: {},
            conversationHistory: [],
            sessionComplete: false,
            waitingForNextResponse: false,
            sessionUsed: false
        };

        // Your complete Maya prompt
        const MAYA_PROMPT = `# Maya - Million Dollar Gap Breakthrough Session Chatbot Prompt

## IDENTITY & ROLE
You are Maya, the Million Dollar Gap Advisor. You represent Chelsie Kenyon's Business Alchemy methodology. Your purpose is to help established entrepreneurs ($5k-$20k/month) realize they're focused on the wrong solutions - trying to get better at tactics instead of building strategic business architecture with an ecosystem.

## VOICE & TONE

### Chelsie's Specific Language Patterns
**Use these phrases:**
- "I totally get it"
- "Here's the thing..."
- "What if instead of..."
- "So you can..." (when describing outcomes)
- "Desire" instead of "want"
- "Encapsulate your magic"
- "Heavy-lifting" (what systems do for you)
- "Wake up to new sales from work you did last year"
- "Business architecture" not just "systems"
- "Ecosystem" not just "funnel"
- "Reimagine" not "fix" or "change"

**Sentence Structure:**
- Use "..." for natural conversational pauses
- Lead with validation, then shift perspective
- Never "you need to" - always "what if you..."
- Frame everything as possibilities, not requirements

**Tone Characteristics:**
- Conversational but authoritative
- Confident without being pushy
- Always validates their current approach before offering alternative
- Focus on outcomes and freedom, not problems or pain
- Leadership-focused: position as strategic advisor, not cheerleader

### AVOID These Phrases:
- Typical coach speak: "amazing," "incredible journey," "transformation"
- Pushy language: "you must," "you have to," "you need to"
- Victim language about their struggles
- Generic business terms: "optimize," "leverage," "scale" (unless specific context)
- High-pressure tactics: "limited time," "don't miss out"

## CONVERSATION FLOW

The user has already provided their basic information through a form. Now respond to their main challenge with a personalized reframe using the categories below.

### Main Question Response
The user has answered: "What's the main thing you've been trying to get better at to grow your business?"
And followed up with what they've tried.

Provide a personalized reframe using their information and the appropriate category below.

## REFRAME CATEGORIES

### STRATEGIC/LEADERSHIP
**"Scaling without losing quality"**
"I totally get it, [Name]. Many entrepreneurs at your level focus on scaling without losing quality, and maintaining standards is crucial. But constantly trying to control every detail as you grow often means you become the bottleneck. What if instead of trying to maintain quality through your personal oversight, you built business architecture that encapsulates your standards and delivers them consistently - so your quality actually improves as you scale because the ecosystem enforces excellence?"

**"Building systems that don't require me"**
"Many entrepreneurs desire to build systems that don't require them, and you're thinking strategically. But most people systematize the wrong things or copy someone else's systems that don't fit their business. What if instead of just building systems, you built an entire ecosystem where each piece works together to run your business - so you're not just absent from tasks, but your genius is embedded in everything that happens?"

**"Transitioning from doer to CEO"**
"I totally get it, [Name]. Many entrepreneurs at your level struggle with transitioning from doer to CEO, and leadership evolution is necessary for growth. But trying to just 'step back' without the right architecture often creates chaos. What if instead of just changing your role, you built business architecture that captures your decision-making and strategic thinking - so you can lead from a higher level while your ecosystem handles execution?"

**"Creating predictable revenue"**
"Many entrepreneurs focus on creating predictable revenue, and consistency is valuable for growth. But chasing predictability through launches or marketing tactics keeps you on a hamster wheel. What if instead of trying to predict revenue from campaigns, you built an ecosystem that generates consistent sales from work you did months ago - so predictability comes from architecture, not effort?"

### PREMIUM POSITIONING
**"Charging premium prices"**
"I totally get it, [Name]. Many entrepreneurs at your level focus on charging premium prices, and value-based pricing matters. But constantly justifying higher prices often means your positioning isn't strong enough to support them. What if instead of just raising your prices, you built business architecture that makes you the obvious choice - so premium pricing feels natural because clients clearly see you're in a category of one?"

**"Positioning as the industry expert"**
"Many entrepreneurs desire to position as the industry expert, and thought leadership drives premium opportunities. But constantly creating content to prove expertise often feels like shouting into the void. What if instead of trying to convince people you're the expert, you built an ecosystem that demonstrates your methodology so powerfully that expert status becomes inevitable - so your authority speaks for itself?"

**"Getting comfortable being seen as THE expert"**
"I totally get it, [Name]. Many entrepreneurs struggle with being seen as THE expert, and owning your authority matters at this level. But comfort comes from confidence, and confidence comes from results. What if instead of working on comfort levels, you built business architecture that establishes your expertise so clearly that being seen as THE expert becomes natural - so your positioning is supported by systems, not just mindset?"

**"Moving beyond competing on price"**
"Many entrepreneurs want to move beyond competing on price, and differentiation is crucial for premium positioning. But trying to compete on value while using the same business model as everyone else keeps you in price wars. What if instead of just changing your messaging, you built an entirely different ecosystem that positions you as the only solution - so you're not competing at all because you've created your own category?"

### SOPHISTICATED BUSINESS CHALLENGES
**"Building a team that actually works"**
"I totally get it, [Name]. Many entrepreneurs at your level focus on building a team that actually works, and the right people matter for scaling. But constantly managing team performance often means your business architecture isn't clear enough to guide them. What if instead of just hiring better people, you built business architecture so clear that your team naturally knows what to do - so they can execute your vision without constant oversight?"

**"Creating business architecture vs just systems"**
"Many entrepreneurs think about creating business architecture vs just systems, and you're thinking at the right level. But most people still approach it tactically, building disconnected processes. What if instead of adding more systems, you designed one comprehensive ecosystem where every element serves the bigger strategy - so your architecture works as one unified organism rather than separate parts?"

**"Moving from launch-dependent to ecosystem-driven"**
"I totally get it, [Name]. Many entrepreneurs desire to move from launch-dependent to ecosystem-driven revenue, and sustainability matters for long-term growth. But trying to reduce launch dependency while keeping the same business model just spreads you thinner. What if instead of launching less, you built an ecosystem that works whether you're launching or not - so launches become amplifiers rather than requirements?"

**"Converting high-level prospects"**
"Many entrepreneurs focus on converting high-level prospects, and premium clients require different approaches. But trying to close sophisticated buyers with traditional sales tactics often backfires. What if instead of getting better at selling, you built an ecosystem that attracts people who are already ready to invest at your level - so conversations become consultations rather than convincing sessions?"

### ADVANCED MINDSET
**"Stepping into bigger leadership"**
"I totally get it, [Name]. Many entrepreneurs at your level focus on stepping into bigger leadership, and executive presence matters for the next level. But leadership isn't just about mindset - it's about having the architecture to support bigger decisions. What if instead of just working on leadership skills, you built business architecture that amplifies your leadership - so your systems execute your vision at scale while you focus on strategy?"

**"Getting over imposter syndrome at this level"**
"Many entrepreneurs struggle with imposter syndrome at your level, and it's common when you're ready for bigger things. But imposter syndrome often signals that you need architecture to match your ambition. What if instead of just working on confidence, you built business architecture that establishes your authority so clearly that imposter syndrome becomes irrelevant - so your expertise is proven by results, not just belief?"

**"Managing the isolation of high-level success"**
"I totally get it, [Name]. Many entrepreneurs experience isolation at high levels of success, and it's lonely when fewer people understand your challenges. But isolation often comes from operating in tactics rather than connecting with other strategic thinkers. What if instead of just seeking connection, you built business architecture that positions you among other ecosystem builders - so you naturally connect with peers who think strategically?"

### AUDIENCE/VISIBILITY
**"Growing my audience strategically"**
"Many entrepreneurs focus on growing their audience strategically, and intentional growth matters at your level. But building audience without clear ecosystem architecture often attracts the wrong people. What if instead of just growing your audience, you built messaging that attracts people who are already perfect fits for your ecosystem - so you grow a smaller audience of higher-value prospects rather than just bigger numbers?"

**"Being more visible in my industry"**
"I totally get it, [Name]. Many entrepreneurs desire to be more visible in their industry, and visibility helps establish authority. But competing for attention in crowded spaces often means you're fighting for scraps. What if instead of trying to be more visible, you built such a distinctive ecosystem that you become the obvious expert in your category - so visibility happens naturally because you've created something unique?"

**"Attracting higher-level clients"**
"Many entrepreneurs focus on attracting higher-level clients, and premium prospects think differently than typical leads. But trying to attract sophisticated buyers with typical marketing often repels them. What if instead of just changing your messaging, you built an ecosystem that demonstrates the level of thinking your premium clients expect - so they recognize you as someone who operates at their level?"

## REFRAME FORMULA FOR UNLISTED RESPONSES
If their answer doesn't match any category above, use this structure with personalization:

1. **Validate with personalization**: "I totally get it, [Name]. Many entrepreneurs in your industry focus on [their answer], and [positive acknowledgment]"
2. **Point out limitation**: "But [what's wrong with focusing on this tactical approach]"
3. **Shift to ecosystem**: "What if instead of [their approach], you built [ecosystem solution that addresses their underlying need]"
4. **Paint outcome**: "so [benefit/freedom they'd experience]"

## AFTER THE REFRAME
After delivering any reframe, continue with:

"Here's the thing - you're already successful. You know how to create results. But what got you to where you are now isn't going to get you to your next level without burning you out.

I just revealed what I call the Million Dollar Gap - the space between tactical improvements and strategic business architecture. Most entrepreneurs stay stuck in tactics because they don't know how to build the architecture.

Chelsie actually created something specifically for women entrepreneurs like you, desiring [reference what they desire based on their situation]. It's a private podcast called **'The Million Dollar Plan: How to Build an Aligned Ecosystem'** and you can get access right now for $27. 

In the 3 quick and easy-to-listen-to episodes, Chelsie walks you through the exact process she takes her private clients through to encapsulate your magic and deliver it to the right person at the right time, so you can wake up to new sales from work you did last year.

If you desire Chelsie's help executing each step, you can apply to work with her directly.

Ready to close the gap?"

## TECHNICAL NOTES
- Keep responses conversational but focused
- Always use the personalization from their provided information
- Match their energy level and communication style
- Focus on the ecosystem methodology as THE solution`;

        function checkSessionUsage() {
            const hasUsed = localStorage.getItem('maya_session_used');
            if (hasUsed) {
                showSessionLimitMessage();
                return true;
            }
            return false;
        }
        
        function markSessionUsed() {
            localStorage.setItem('maya_session_used', 'true');
        }
        
        function showSessionLimitMessage() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = `
                <div class="message maya" style="max-width: 90%; text-align: center; margin: 20px auto;">
                    <h3 style="margin-bottom: 15px;">Oops! Looks like you've already completed your breakthrough session! ðŸŽ‰</h3>
                    <p style="margin-bottom: 20px;">Each person gets one personalized Million Dollar Gap session. Ready to dive deeper into building your ecosystem?</p>
                    <button class="purchase-btn" onclick="window.open('https://www.chelsiekenyon.com/milliondollarplan', '_blank')" style="margin: 0;">Get The Million Dollar Plan - $27</button>
                </div>
            `;
            
            document.getElementById('userInput').style.display = 'none';
            document.getElementById('sendBtn').style.display = 'none';
        }

        function initializeChat() {
            if (checkSessionUsage()) {
                return;
            }
            conversationState.stage = 'name';
            addMayaMessage("Hey! I'm Maya, and I help established entrepreneurs identify the million dollar gap in their business strategy.<br><br>Before we dive in, I'd love to learn a bit about you and your business so I can give you the most relevant insights. Let me ask you a few quick questions:<br><br><strong>What's your name?</strong>");
        }
        
        function addMessage(content, isUser = false) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'maya'}`;
            
            // Convert markdown-style bold to HTML
            content = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            messageDiv.innerHTML = content;
            messagesContainer.appendChild(messageDiv);
            
            // Better mobile scrolling
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }
        
        function addMayaMessage(content) {
            addMessage(content, false);
        }
        
        function addUserMessage(content) {
            addMessage(content, true);
        }
        
        function showTyping() {
            document.getElementById('typingIndicator').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
            }, 100);
        }
        
        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }
        
        function logUserData() {
            const userData = conversationState.userData;
            const logData = {
                timestamp: new Date().toISOString(),
                name: userData.name || 'Not provided',
                niche: userData.niche || 'Not provided',
                timeInBusiness: userData.timeInBusiness || 'Not provided',
                revenue: userData.revenue || 'Not provided',
                mainChallenge: userData.mainChallenge || 'Not provided',
                whatTriedSoFar: userData.whatTriedSoFar || 'Not provided'
            };
            
            // Log to console so you can see it in your backend logs
            console.log('=== MAYA CHAT COMPLETION ===');
            console.log(JSON.stringify(logData, null, 2));
            console.log('=== END CHAT DATA ===');
            
            // Also send to your backend for logging
            fetch('https://maya-chat-widget.vercel.app/api/log-chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(logData)
            }).catch(err => console.log('Logging failed:', err));
        }
        
        async function processUserInput(input) {
            conversationState.conversationHistory.push({role: 'user', content: input});
            
            switch(conversationState.stage) {
                case 'name':
                    // Check if they gave a valid name
                    const lowerName = input.toLowerCase().trim();
                    if (lowerName === 'hello' || lowerName === 'hi' || lowerName === 'hey' || lowerName === 'test' || lowerName === 'asdf' || lowerName === 'name' || lowerName === 'idk' || lowerName === 'i don\'t know' || lowerName.length < 2 || /^\d+$/.test(lowerName)) {
                        return `I'd love to use your actual name so I can personalize our conversation! What's your first name?`;
                    }
                    
                    conversationState.userData.name = input;
                    conversationState.stage = 'niche';
                    return `Great to meet you, ${input}!<br><br><strong>Who do you help? (What's your niche or industry?)</strong>`;
                    
                case 'niche':
                    conversationState.userData.niche = input;
                    conversationState.stage = 'time_in_business';
                    
                    // Simple personalization based on keywords
                    let nicheResponse = '';
                    const lowerInput = input.toLowerCase();
                    if (lowerInput.includes('women') || lowerInput.includes('woman')) {
                        nicheResponse = "That's such important work, helping women!";
                    } else if (lowerInput.includes('entrepreneur') || lowerInput.includes('business')) {
                        nicheResponse = "Love that you're supporting entrepreneurs!";
                    } else if (lowerInput.includes('coach') || lowerInput.includes('mentor')) {
                        nicheResponse = "Coaching work is so impactful!";
                    } else if (lowerInput.includes('health') || lowerInput.includes('wellness') || lowerInput.includes('fitness')) {
                        nicheResponse = "Health and wellness work is so needed!";
                    } else if (lowerInput.includes('creative') || lowerInput.includes('artist') || lowerInput.includes('design')) {
                        nicheResponse = "Creative work brings so much beauty to the world!";
                    } else {
                        nicheResponse = "That sounds like really meaningful work!";
                    }
                    
                    return `${nicheResponse}<br><br><strong>How long have you been in business?</strong>`;
                    
                case 'time_in_business':
                    // Check if they're trying to correct their previous answer
                    if (input.toLowerCase().includes('actually') || input.toLowerCase().includes('correction') || input.toLowerCase().includes('both') || input.toLowerCase().includes('men') || input.toLowerCase().includes('everyone')) {
                        return `Got it! Thanks for clarifying. So you help a broader audience - that's great!<br><br><strong>How long have you been in business?</strong>`;
                    }
                    
                    // Check if they gave a valid time answer
                    const lowerTime = input.toLowerCase();
                    if (!lowerTime.includes('year') && !lowerTime.includes('month') && !lowerTime.includes('1') && !lowerTime.includes('2') && !lowerTime.includes('3') && !lowerTime.includes('4') && !lowerTime.includes('5') && !lowerTime.includes('6') && !lowerTime.includes('7') && !lowerTime.includes('8') && !lowerTime.includes('9') && !lowerTime.includes('one') && !lowerTime.includes('two') && !lowerTime.includes('three') && !lowerTime.includes('four') && !lowerTime.includes('five')) {
                        return `I'd love to know how long you've been in business to give you the most relevant insights. For example: "2 years" or "6 months" - how long have you been running your business?`;
                    }
                    
                    conversationState.userData.timeInBusiness = input;
                    conversationState.stage = 'revenue';
                    let timeResponse = '';
                    if (input.includes('year')) {
                        if (input.includes('1') || input.includes('one')) {
                            timeResponse = `A year in business - you're building something real!`;
                        } else if (input.includes('2') || input.includes('two')) {
                            timeResponse = `Two years - you've gotten through the hardest part!`;
                        } else if (input.includes('3') || input.includes('three')) {
                            timeResponse = `Three years - that's some serious staying power!`;
                        } else {
                            timeResponse = `${input} - that shows real commitment and persistence!`;
                        }
                    } else {
                        timeResponse = `${input} - that's incredible dedication!`;
                    }
                    return `${timeResponse}<br><br><strong>What's your current monthly revenue range?</strong>`;
                    
                case 'revenue':
                    // Check if they gave a valid revenue answer
                    const lowerRevenue = input.toLowerCase();
                    if (!lowerRevenue.includes('k') && !lowerRevenue.includes('thousand') && !lowerRevenue.includes('$') && !lowerRevenue.includes('0')) {
                        return `I'd love to know your current monthly revenue range to give you the most relevant insights. For example: "$5k-$10k/month" or "Under $5k/month" - what would you say yours is?`;
                    }
                    
                    conversationState.userData.revenue = input;
                    conversationState.stage = 'main_question';
                    return `Thanks, ${conversationState.userData.name}! Now here's the question that is going to reveal everything:<br><br><strong>What's the main thing you've been trying to get better at to grow your business?</strong>`;
                    
                case 'main_question':
                    conversationState.userData.mainChallenge = input;
                    conversationState.stage = 'follow_up';
                    return `Got it. What have you tried so far to improve this?`;
                    
                case 'follow_up':
                    conversationState.userData.whatTriedSoFar = input;
                    conversationState.stage = 'waiting_for_next';
                    conversationState.waitingForNextResponse = true;
                    logUserData();
                    return await generatePersonalizedReframe();
                    
                case 'waiting_for_next':
                    if (input.toLowerCase().includes('yes') || input.toLowerCase().includes('sure') || input.toLowerCase().includes('tell me') || input.toLowerCase().includes('what')) {
                        conversationState.stage = 'complete';
                        conversationState.sessionComplete = true;
                        markSessionUsed(); // Mark session as used when they complete
                        return generateOfferResponse();
                    } else {
                        return `No worries! If you change your mind and want to hear about the solution, just let me know.`;
                    }
                    
                default:
                    if (conversationState.sessionComplete) {
                        return `This session is complete! If you have more questions, I'd love to continue the conversation inside The Million Dollar Plan.<br><br><button class="purchase-btn" onclick="window.open('https://www.chelsiekenyon.com/milliondollarplan', '_blank')">Get The Million Dollar Plan - $27</button>`;
                    }
                    return `I'm not sure I understand. Could you please rephrase that?`;
            }
        }
        
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message || conversationState.sessionComplete) return;
            
            input.disabled = true;
            document.getElementById('sendBtn').disabled = true;
            
            addUserMessage(message);
            input.value = '';
            
            showTyping();
            
            try {
                const response = await processUserInput(message);
                
                setTimeout(() => {
                    hideTyping();
                    addMayaMessage(response);
                    
                    if (!conversationState.sessionComplete) {
                        input.disabled = false;
                        document.getElementById('sendBtn').disabled = false;
                        input.focus();
                    } else {
                        input.style.display = 'none';
                        document.getElementById('sendBtn').style.display = 'none';
                    }
                }, 1500);
                
            } catch (error) {
                hideTyping();
                addMayaMessage("I'm having a technical moment! Please try again.");
                input.disabled = false;
                document.getElementById('sendBtn').disabled = false;
            }
        }
        
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        async function generatePersonalizedReframe() {
            const userData = conversationState.userData;
            
            const contextMessage = `Please provide a personalized reframe for this user, but STOP after revealing the Million Dollar Gap. Do not include the offer yet:

Name: ${userData.name}
Industry/Niche: ${userData.niche}  
Time in business: ${userData.timeInBusiness}
Revenue: ${userData.revenue}
Main challenge they want to get better at: ${userData.mainChallenge}
What they've tried so far: ${userData.whatTriedSoFar}

Use the reframe categories and formula provided in your instructions. Include proper paragraph breaks for readability. Add some bold text for emphasis. End by asking "Would you like to hear what's next?"`;

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: contextMessage }],
                        prompt: MAYA_PROMPT
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'API call failed');
                }
                
                return data.message;
                
            } catch (error) {
                console.error('API Error:', error);
                return generateFallbackReframe();
            }
        }
        
        function generateOfferResponse() {
            const userData = conversationState.userData;
            
            let response = `<strong>Great!</strong> Chelsie actually created something specifically for women entrepreneurs like you, desiring to grow beyond tactical improvements.<br><br>`;
            
            response += `It's a private podcast called <strong>'The Million Dollar Plan: How to Build an Aligned Ecosystem'</strong> and you can get access right now for $27.<br><br>`;
            
            response += `In the <strong>3 quick and easy-to-listen-to episodes</strong>, Chelsie walks you through the exact process she takes her private clients through to encapsulate your magic and deliver it to the right person at the right time, so you can <strong>wake up to new sales from work you did last year</strong>.<br><br>`;
            
            response += `If you desire Chelsie's help executing each step, you can apply to work with her directly.<br><br>`;
            
            response += '<button class="purchase-btn" onclick="window.open(\'https://www.chelsiekenyon.com/milliondollarplan\', \'_blank\')">Get The Million Dollar Plan - $27</button><br><br>';
            
            response += `<strong>Ready to close the gap?</strong>`;
            
            return response;
        }
        
        function generateFallbackReframe() {
            const userData = conversationState.userData;
            
            // Interpret their challenge more naturally
            let challenge = userData.mainChallenge.toLowerCase();
            if (challenge.includes('visibility') || challenge.includes('engagement') || challenge.includes('instagram')) {
                challenge = 'growing their social media presence';
            } else if (challenge.includes('launch')) {
                challenge = 'launching';
            } else if (challenge.includes('content')) {
                challenge = 'content creation';
            } else if (challenge.includes('sales') || challenge.includes('sell')) {
                challenge = 'selling';
            } else {
                challenge = 'tactical improvements';
            }
            
            let reframe = `I totally get it, ${userData.name}. Many entrepreneurs in your industry focus on ${challenge}, and you've clearly been putting in the work with everything you've tried.<br><br>`;
            
            reframe += `But constantly trying to perfect tactics keeps you stuck in reactive mode rather than building strategic business architecture.<br><br>`;
            
            reframe += `What if instead of trying to get better at ${challenge}, you built an ecosystem that encapsulates your magic and delivers it to the right person at the right time - so you can <strong>wake up to new sales from work you did last year</strong>?<br><br>`;
            
            reframe += `<strong>Here's the thing</strong> - you're already successful. You know how to create results. But what got you to where you are now isn't going to get you to your next level without burning you out.<br><br>`;
            
            reframe += `I just revealed what I call <strong>the Million Dollar Gap</strong> - the space between tactical improvements and strategic business architecture. Most entrepreneurs stay stuck in tactics because they don't know how to build the architecture.<br><br>`;
            
            reframe += `<strong>Would you like to hear what's next?</strong>`;
            
            return reframe;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeChat();
        });
    </script>
</body>
</html>
